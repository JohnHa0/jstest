<!DOCTYPE html>
<!--
	NOTES:
	1. All tokens are represented by '$' sign in the template.
	2. You can write your code only wherever mentioned.
	3. All occurrences of existing tokens will be replaced by their appropriate values.
	4. Blank lines will be removed automatically.
	5. Remove unnecessary comments before creating your template.
-->
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<meta content="yes" name="apple-mobile-web-app-capable">     
<meta content="black" name="apple-mobile-web-app-status-bar-style">     
<meta content="telephone=no" name="format-detection">
<title>品味中秋</title>
<style>
input:focus{
    outline: none;
}
*{
padding:0px;
margin:0px;
position:absolute;
}
body{
	background-color:#333333;
	overflow:scroll;
	overflow-y:hidden;
	overflow-x:hidden;
}
</style>
<script src="../createjs-2015.11.26.min.js"></script>
<script src="../EasyCreateJS.js"></script>
<script src="indexgame.js?1661218619406"></script>
<script>
var canvas, stage, exportRoot, anim_container, dom_overlay_container, fnStartAnimation;
var GTIME=300;
function init() {
	canvas = document.getElementById("canvas");
	anim_container = document.getElementById("animation_container");
	dom_overlay_container = document.getElementById("dom_overlay_container");
	images = images||{};
	var loader = new createjs.LoadQueue(false);
	loader.addEventListener("fileload", handleFileLoad);
	loader.addEventListener("complete", handleComplete);
	loader.loadManifest(lib.properties.manifest);
	var platform=new EasyCreateJS.Platform();
	mainRC=document.getElementById("animation_container");
	EasyCreateJS.fitScreen(mainRC,640,1136,platform.isMobile);
	initLoading();
}
var loadingView;
var loadingTiao;
var loadingCount;
var loadingTotal;
var loadingText;
function initLoading(){
	loadingView=document.getElementById("loading_container");
	loadingTiao=document.getElementById("tiao");
	loadingText=document.getElementById("loadingText");
	loadingCount=0;
	loadingTotal=lib.properties.manifest.length;
}
function handleFileLoad(evt) {	
	if (evt.item.type == "image") {
	 images[evt.item.id] = evt.result;
	 loadingCount+=1;
		var p=loadingCount/loadingTotal;
		loadingTiao.style.left=(p*lib.properties.width-640)+"px";
		loadingText.innerHTML="loading..."+String(Math.floor(p*100))+"%"; 
	  }	
}
function handleComplete(evt) {
	//This function is always called, irrespective of the content. You can use the variable "stage" after it is created in token create_stage.
	var queue = evt.target;
	var ssMetadata = lib.ssMetadata;
	for(i=0; i<ssMetadata.length; i++) {
		ss[ssMetadata[i].name] = new createjs.SpriteSheet( {"images": [queue.getResult(ssMetadata[i].name)], "frames": ssMetadata[i].frames} )
	}
	exportRoot = new lib.indexgame();
	stage = new createjs.Stage(canvas);
	stage.addChild(exportRoot);	
	createjs.Ticker.setFPS(lib.properties.fps);
	createjs.Ticker.timingMode = createjs.Ticker.RAF_SYNCHED;
	createjs.Ticker.addEventListener("tick", stage);
	createjs.Ticker.addEventListener("tick",addto);    
	createjs.Touch.enable(stage);
}
var sdm;
function initSDM(){
	sdm=new EasyCreateJS.SoundMaster();
	sdm.addSound("../sounds/sdR.mp3","r",1);
	sdm.addSound("../sounds/sdW.mp3","w",1);
}
function addto(){
	createjs.Ticker.removeEventListener("tick",addto);
	mainRC.removeChild(loadingView);
	initSDM();
	initPart1();
	initPart2();
	showPart1();
}
function initPart1(){
	var rc=exportRoot.part1rc;
	rc.visible=false;
	initDragUnit(rc.d1,rc.g1);
	initDragUnit(rc.d2,rc.g2);
	initDragUnit(rc.d3,rc.g3);
	initDragUnit(rc.d4,rc.g4);
	rc.bt_back.addEventListener("click",EasyCreateJS.ReactButtonHelper(rc.bt_back,rc.bt_backw,GTIME,function(){
		if(!rc.resultrc.visible){
			if(window.parent!=window && window.parent.unload){
				rc.removeEventListener("pressmove",part2_pm);
				rc.removeEventListener("pressup",part2_pu);
				window.parent.unload();
			}
		}
	}));
	rc.resultrc.visible=false;
	rc.resultrc.bt_next.addEventListener("click",EasyCreateJS.ReactButtonHelper(rc.resultrc.bt_next,rc.resultrc.bt_nextw,GTIME,function(){
		rc.resultrc.visible=rc.visible=false;
		showPart2();
	}));
	draged=null;
}
function showPart2(){
	var rc=exportRoot.part2rc;
	rc.visible=true;
	rc.resultrc.visible=false;
}
function showPart1(){
	var rc=exportRoot.part1rc;
	rc.visible=true;
	rc.resultrc.visible=false;
}
var draged=null;
var dx;
var dy;
function initDragUnit(d,g){
	d.addEventListener("mousedown",part1_d);
	d.ox=d.x;
	d.oy=d.y;
	g.visible=false;
	d.gp=g;
}
function part1_d(e){
	if(draged==null && !exportRoot.part1rc.resultrc.visible){
		draged=e.currentTarget;
		dx=e.stageX-draged.x;
		dy=e.stageY-draged.y;
		draged.parent.addChild(draged);
		exportRoot.part1rc.addEventListener("pressmove",part1_pm);
		exportRoot.part1rc.addEventListener("pressup",part1_pu);
	}
}
function part1_pm(e){
	if(draged){
		draged.x=e.stageX-dx;
		draged.y=e.stageY-dy;
	}
}
function part1_pu(e){
	var rc=exportRoot.part1rc;
	rc.removeEventListener("pressmove",part1_pm);
	rc.removeEventListener("pressup",part1_pu);
	if(Math.abs(draged.x-draged.gp.x)<50 && Math.abs(draged.y-draged.gp.y)<50){
		draged.visible=false;
		draged.gp.visible=true;
		sdm.play("r");
	}else{
		draged.x=draged.ox;
		draged.y=draged.oy;
		sdm.play("w");
	}
	draged=null;
	if(1){
		rc.resultrc.visible=true;
	}
}
function initPart2(){
	var rc=exportRoot.part2rc;
	rc.visible=false;
	initDragUnit2(rc.d1);
	initDragUnit2(rc.d2);
	initDragUnit2(rc.d3);
	initDragUnit2(rc.d4);
	initDragUnit2(rc.d5);
	initDragUnit2(rc.d6);
	initDragUnit2(rc.d7);
	initDragUnit2(rc.d8);
	initDragUnit2(rc.d9);
	rc.titlerc.visible=false;
	rc.box.stop();
	rc.titlerc.bt_start.addEventListener("click",EasyCreateJS.ReactButtonHelper(rc.titlerc.bt_start,rc.titlerc.bt_startw,GTIME,function(){
		rc.titlerc.visible=false;
	}));
	rc.bt_back.addEventListener("click",EasyCreateJS.ReactButtonHelper(rc.bt_back,rc.bt_backw,GTIME,function(){
		if(!rc.resultrc.visible && !rc.titlerc.visible){
			if(window.parent!=window && window.parent.unload){
				rc.removeEventListener("pressmove",part2_pm);
				rc.removeEventListener("pressup",part2_pu);
				window.parent.unload();
			}
		}
	}));
	rc.resultrc.visible=false;
	rc.resultrc.bt_back.addEventListener("click",EasyCreateJS.ReactButtonHelper(rc.resultrc.bt_back,rc.resultrc.bt_backw,GTIME,function(){
		if(window.parent!=window && window.parent.unload){
			window.parent.unload();
		}
	}));
}

function initDragUnit2(d){
	d.ox=d.x;
	d.oy=d.y;
	d.addEventListener("mousedown",part2_d);
}
function part2_d(e){
	var rc=exportRoot.part2rc;
	if(draged==null && !rc.resultrc.visible && !rc.titlerc.visible) {
		rc.addEventListener("pressmove",part2_pm);
		rc.addEventListener("pressup",part2_pu);	
		
		draged=e.currentTarget;
		draged.parent.addChild(draged);
		dx=e.stageX-draged.x;
		dy=e.stageY-draged.y;
	}
}
function part2_pm(e){
	if(draged){
		draged.x=e.stageX-dx;
		draged.y=e.stageY-dy;
	}
}
function part2_pu(){
	var rc=exportRoot.part2rc;
	rc.removeEventListener("pressmove",part2_pm);
	rc.removeEventListener("pressup",part2_pu);
	//alert('333')
	if(Math.abs(rc.box.x-draged.x)<60 && Math.abs(rc.box.y-draged.y)<60){
		//alert('ddd')
		if(1){
			draged.visible=false;
			sdm.play("r");
			rc.box.gotoAndPlay(1);
			if(1){
				rc.resultrc.visible=true;
				rc.addChild(rc.resultrc);
			}	
		}else{
			draged.x=draged.ox;
			draged.y=draged.oy;
			sdm.play("w");
		}
	}else{
			draged.x=draged.ox;
			draged.y=draged.oy;
	}
	
	draged=null;
}
</script>
</head>
<body onLoad="init();" style="margin:0px;">
	<div id="animation_container" style="background-color:rgba(255, 255, 255, 1.00); width:640px; height:1136px">
		<canvas id="canvas" width="640" height="1136" style="position: absolute; display: block; background-color:rgba(255, 255, 255, 1.00);"></canvas>
		<div id="dom_overlay_container" style="pointer-events:none; overflow:hidden; width:640px; height:1136px; position: absolute; left: 0px; top: 0px; display: block;">
		</div>
         <div id="loading_container" style="width:640px;height:1136px;position:absolute;overflow:hidden;">
		<img src="../images/loadingBG.jpg"></img>
        <img id="tiao" src="../images/loadingT.png" style="top:1006px"></img>
        <img src="../images/loadingE.png" style="top:1006px"></img>
        <p id="loadingText" style="top:1050px;display:inline-block; color:#333333;width:640px;height:30px;font-size:20px;line-height:30px;text-align:center;">0%<p>
        </div>
	</div>
</body>
</html>