<!DOCTYPE html>
<!--
	NOTES:
	1. All tokens are represented by '$' sign in the template.
	2. You can write your code only wherever mentioned.
	3. All occurrences of existing tokens will be replaced by their appropriate values.
	4. Blank lines will be removed automatically.
	5. Remove unnecessary comments before creating your template.
-->
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<meta content="yes" name="apple-mobile-web-app-capable">     
<meta content="black" name="apple-mobile-web-app-status-bar-style">     
<meta content="telephone=no" name="format-detection">
<title>中秋妙可言</title>
<style>
input:focus{
    outline: none;
}
*{
padding:0px;
margin:0px;
position:absolute;
}
body{
	background-color:#333333;
	overflow:scroll;
	overflow-y:hidden;
	overflow-x:hidden;
}
</style>
<script src="../createjs-2015.11.26.min.js"></script>
<script src="../EasyCreateJS.js"></script>
<script src="indexgame.js?1661145294518"></script>
<script>
var canvas, stage, exportRoot, anim_container, dom_overlay_container, fnStartAnimation;
function init() {
	canvas = document.getElementById("canvas");
	anim_container = document.getElementById("animation_container");
	dom_overlay_container = document.getElementById("dom_overlay_container");
	images = images||{};
	var loader = new createjs.LoadQueue(false);
	loader.addEventListener("fileload", handleFileLoad);
	loader.addEventListener("complete", handleComplete);
	loader.loadManifest(lib.properties.manifest);
	var platform=new EasyCreateJS.Platform();
	mainRC=document.getElementById("animation_container");
	EasyCreateJS.fitScreen(mainRC,640,1136,platform.isMobile);
	initLoading();
}
var loadingView;
var loadingTiao;
var loadingCount;
var loadingTotal;
var loadingText;
function initLoading(){
	loadingView=document.getElementById("loading_container");
	loadingTiao=document.getElementById("tiao");
	loadingText=document.getElementById("loadingText");
	loadingCount=0;
	loadingTotal=lib.properties.manifest.length;
}
function handleFileLoad(evt) {	
	if (evt.item.type == "image") {
	 images[evt.item.id] = evt.result;
	loadingCount+=1;
		var p=loadingCount/loadingTotal;
		loadingTiao.style.left=(p*lib.properties.width-640)+"px";
		loadingText.innerHTML="loading..."+String(Math.floor(p*100))+"%"; 
	 }	
}
function handleComplete(evt) {
	//This function is always called, irrespective of the content. You can use the variable "stage" after it is created in token create_stage.
	var queue = evt.target;
	var ssMetadata = lib.ssMetadata;
	for(i=0; i<ssMetadata.length; i++) {
		ss[ssMetadata[i].name] = new createjs.SpriteSheet( {"images": [queue.getResult(ssMetadata[i].name)], "frames": ssMetadata[i].frames} )
	}
	exportRoot = new lib.indexgame();
	stage = new createjs.Stage(canvas);
	stage.addChild(exportRoot);
	stage.enableMouseOver();	
	createjs.Ticker.setFPS(lib.properties.fps);
	createjs.Ticker.timingMode = createjs.Ticker.RAF_SYNCHED;
	createjs.Ticker.addEventListener("tick", stage);
	createjs.Ticker.addEventListener("tick",addto);    
	createjs.Touch.enable(stage);
}
function addto(){
	createjs.Ticker.removeEventListener("tick",addto);
	mainRC.removeChild(loadingView);
	initTest();
	
	//initTitle();
	initResult();
	initSDM();
	startTest();
}
var GTIME=300;
var lock=false;
/*function initTitle(){
	var rc=exportRoot.titlerc;
	rc.bt_start.addEventListener("click",EasyCreateJS.ReactButtonHelper(rc.bt_start,rc.bt_startw,GTIME,function(){
		rc.visible=false;
		startTest();
	}));
}*/
function initResult(){
	var rc=exportRoot.resultrc;
	rc.bt_back.addEventListener("click",EasyCreateJS.ReactButtonHelper(rc.bt_back,rc.bt_backw,GTIME,function(){
		if(window.parent!=null && window.parent.submitTest!=null && window.parent.unload!=null){
			alert(exportRoot.testrc.time)
			//exportRoot.testrc.time=550
			window.parent.submitTest(exportRoot.testrc.score,exportRoot.testrc.time);
			window.parent.unload();
		}
	}));
	rc.visible=false;
}
function startTest(){
	var rc=exportRoot.testrc;
	rc.testArr.sort(rnd);
	rc.score=0;
	rc.time=0;
	rc.timeID=window.setInterval(count,40);
	rc.ind=0;
	rc.t_t.text="00:00";
	rc.s_t.text="0";
	rc.fmc.gotoAndStop(rc.testArr[rc.ind].face);
	lock=false;
	rc.xmc.visible=rc.rmc.visible=false;
}
function count(){
	var rc=exportRoot.testrc;
	rc.time+=1;
	rc.t_t.text=fmt(rc.time);
}
function initTest(){
	var rc=exportRoot.testrc;
	rc.bt_back.addEventListener("click",EasyCreateJS.ReactButtonHelper(rc.bt_back,rc.bt_backw,GTIME,function(){
		if( !exportRoot.resultrc.visible){
			if(window.parent!=window && window.parent.unload){
				window.parent.unload();
				window.clearInterval(exportRoot.testrc.timeID);
			}
		}
	}));
	rc.testArr=new Array();
	rc.testArr.push(new TestUnit(0,"A"));
	rc.testArr.push(new TestUnit(1,"B"));
	rc.testArr.push(new TestUnit(2,"B"));
	rc.testArr.push(new TestUnit(3,"A"));
	rc.testArr.push(new TestUnit(4,"B"));
	rc.testArr.push(new TestUnit(5,"B"));
	rc.testArr.push(new TestUnit(6,"A"));
	rc.testArr.push(new TestUnit(7,"B"));
	rc.testArr.push(new TestUnit(8,"A"));
	rc.testArr.push(new TestUnit(9,"A"));
	rc.testArr.push(new TestUnit(10,"B"));
	rc.testArr.push(new TestUnit(11,"B"));
	rc.testArr.push(new TestUnit(12,"B"));
	rc.testArr.push(new TestUnit(13,"A"));
	rc.testArr.push(new TestUnit(14,"B"));
	rc.testArr.push(new TestUnit(15,"A"));
	rc.testArr.push(new TestUnit(16,"B"));
	rc.testArr.push(new TestUnit(17,"B"));
	rc.testArr.push(new TestUnit(18,"A"));
	rc.testArr.push(new TestUnit(19,"A"));
	rc.testArr.push(new TestUnit(20,"B"));
	rc.testArr.push(new TestUnit(21,"B"));
	rc.testArr.push(new TestUnit(22,"B"));
	rc.testArr.push(new TestUnit(23,"A"));
	rc.ind=0;
	rc.score=0;
	rc.time=0;
	rc.timeID=0;
	rc.sltA.addEventListener("click",sltA_c);
	rc.sltB.addEventListener("click",sltB_c);
	rc.fmc.stop();
	lock=false;
}
var sdm;
function initSDM(){
	sdm=new EasyCreateJS.SoundMaster();
	sdm.addSound("../sounds/sdR.mp3","r",1);
	sdm.addSound("../sounds/sdW.mp3","w",1);
}
function sltA_c(e){
	if( !exportRoot.resultrc.visible){
	if(!lock){
		var rc=exportRoot.testrc;
		lock=true;
		var tu=rc.testArr[rc.ind];
		rc.xmc.visible=rc.rmc.visible=false;
		tu.ans='A'
		if(tu.ans=="A"){
			sdm.play("r");
			rc.score+=10;
			rc.s_t.text=String(rc.score);
			rc.rmc.visible=true;
			rc.rmc.y=rc.sltA.y;
		}else{
			sdm.play("w");
			rc.rmc.visible=rc.xmc.visible=true;
			rc.rmc.y=rc.sltB.y;
			rc.xmc.y=rc.sltA.y;
		}
		window.setTimeout(nextTest,1000);
	}
	}
}
function sltB_c(e){
if( !exportRoot.resultrc.visible){
	if(!lock){
		var rc=exportRoot.testrc;
		lock=true;
		var tu=rc.testArr[rc.ind];
		rc.xmc.visible=rc.rmc.visible=false;
		tu.ans='B'
		if(tu.ans=="B"){
			sdm.play("r");
			rc.score+=10;
			rc.s_t.text=String(rc.score);
			rc.rmc.visible=true;
			rc.rmc.y=rc.sltB.y;
		}else{
			sdm.play("w");
			rc.rmc.visible=rc.xmc.visible=true;
			rc.rmc.y=rc.sltA.y;
			rc.xmc.y=rc.sltB.y;
		}
		window.setTimeout(nextTest,2000);
	}
}
}
function nextTest(){
	var rc=exportRoot.testrc;
	rc.ind+=1;
	if(rc.ind>=10){
		exportRoot.resultrc.visible=true;
		exportRoot.resultrc.s_t.text=String(rc.score);
		exportRoot.resultrc.t_t.text=fmt(rc.time);
		window.clearInterval(rc.timeID);
	}else{
		rc.fmc.gotoAndStop(rc.testArr[rc.ind].face);
		rc.xmc.visible=rc.rmc.visible=false;
		lock=false;
	}
}
function rnd(a,b){
	return Math.random()>0.5?1:-1;
}
function fmt(s){
	var secs=Math.floor(s/25);
	var m=Math.floor(secs/60);
	var ss=secs%60;
	return (m>=10?m:"0"+m)+":"+(ss>=10?ss:"0"+ss)
}
function TestUnit(i,a){
	this.face=i;
	this.ans=a;
}
</script>
<!-- write your code here -->
</head>
<body onLoad="init();" style="margin:0px;">
	<div id="animation_container" style="background-color:rgba(255, 255, 255, 1.00); width:640px; height:1136px">
		<canvas id="canvas" width="640" height="1136" style="position: absolute; display: block; background-color:rgba(255, 255, 255, 1.00);"></canvas>
		<div id="dom_overlay_container" style="pointer-events:none; overflow:hidden; width:640px; height:1136px; position: absolute; left: 0px; top: 0px; display: block;">
		</div>
         <div id="loading_container" style="width:640px;height:1136px;position:absolute;overflow:hidden;">
		<img src="../images/loadingBG.jpg"></img>
        <img id="tiao" src="../images/loadingT.png" style="top:1006px"></img>
        <img src="../images/loadingE.png" style="top:1006px"></img>
        <p id="loadingText" style="top:1050px;display:inline-block; color:#333333;width:640px;height:30px;font-size:20px;line-height:30px;text-align:center;">0%<p>
        </div>
	</div>
</body>
</html>